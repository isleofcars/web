{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="HandheldFriendly" content="true">
    <link rel="icon" href="<{% static 'images/favicon.ico' %}">
    <title>Whole Cars Market</title>

    <!-- Styles -->
    <link rel="stylesheet" href="{% static 'styles/main.css' %}?{% now 'U' %}"/>
    <link rel="stylesheet" href="{% static 'styles/filters.css' %}?{% now 'U' %}"/>
    <link rel="stylesheet" href="{% static 'styles/ads.css' %}?{% now 'U' %}"/>
    
    <!-- Scripts -->
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-VWRSHRKYFM"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-VWRSHRKYFM');
    </script>

    <!-- Autocomplete -->
    <link rel="stylesheet" href="{% static 'library/autocomplete/autocomplete.css' %}"/>
    <script src="{% static 'library/autocomplete/autocomplete.js' %}"></script>

    <!-- jQuery -->
    <script type="text/javascript" src="{% static 'library/jquery-3.6.0/jquery.min.js' %}"></script>

    <!-- Bootstrap -->
    <link rel="stylesheet" href="{% static 'library/bootstrap-5.0.2-dist/css/bootstrap.min.css' %}"/>
    <script src="{% static 'library/bootstrap-5.0.2-dist/js/bootstrap.min.js' %}"></script>
    <script src="{% static 'library/bootstrap-5.0.2-dist/js/bootstrap.bundle.min.js' %}"></script>

    <!-- Popper -->
    <!-- <script src="https://unpkg.com/@popperjs/core@2"></script> -->
    

    <!-- Select2 -->
    <!-- <link href="{% static 'library/select2-4.1.0-rc.0/dist/css/select2.min.css' %}" rel="stylesheet"/> -->
    <!-- <script src="{% static 'library/select2-4.1.0-rc.0/dist/js/select2.min.js' %}"></script> -->

    <!-- Bootstrap-Select -->
    <link rel="stylesheet" href="{% static 'library/bootstrap-select-1.14.0-beta2/dist/css/bootstrap-select.min.css' %}"/>
    <script src="{% static 'library/bootstrap-select-1.14.0-beta2/dist/js/bootstrap-select.min.js' %}"></script>
    <!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/js/i18n/defaults-*.min.js"></script> -->
    <!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-/bQdsTh/da6pkI1MST/rWKFNjaCP5gBSY4sEBT38Q/9RBh9AH40zEOg7Hlq2THRZ" crossorigin="anonymous"></script> -->

    <!-- Font Awesome -->
    <script src="https://kit.fontawesome.com/5b91f6b101.js" crossorigin="anonymous"></script>
    
    <!-- Global Variables -->
    <script>
        var makesAll = {{ makes_all|safe }};
        var makesPopular = {{ makes_popular|safe }};
        var ajaxRequest;
    </script>

    <script>
        function readAllFilters() {
            let filters = {
                is_new: $('#filter-is-new input:checked').attr('value'),
                is_broken: $('#filter-is-broken input:checked').attr('value'),
                location: $('#filter-location').val(),
                make: $('#filter-make').val(),
                model: $('#filter-model').val(),
                color: $('#filter-color input:checked').attr('value'),
                body: $('#filter-body option:selected').attr('value'),
                transmission: $('#filter-transmission option:selected').attr('value'),
                drive: $('#filter-drive option:selected').attr('value'),
                with_photos: $('filter-with_photos').prop('checked'),
                power_from: $('#filter-power_from').val(),
                power_to: $('#filter-power_to').val(),
                year_from: $('#filter-year_from').val(),
                year_to: $('#filter-year_to').val(),
                mileage_from: $('#filter-mileage_from').val(),
                mileage_to: $('#filter-mileage_to').val(),
                price_from: $('#filter-price_from').val(),
                price_to: $('#filter-price_to').val()
            };
            return filters;
        };

        function callAjax() {
            let data = readAllFilters();
            ajaxRequest = $.ajax({
                type: 'GET',
                url: '/',
                data: data,
                beforeSend: (jqXHR, settings) => {
                    console.log('data', data);
                    url = settings.url;
                    console.log('settings.url', settings.url);
                    if (url.slice(-1) === '?') url = url.slice(0, -1);
                    window.history.replaceState('', document.title, url);
                    if (ajaxRequest) ajaxRequest.abort();
                },
                success: (ads, statusText, jqHXR) => {
                    console.log('Success');
                    $('#ads-container').html(ads);
                },
                error: (err) => {
                    console.log('Error');
                },
                complete: () => {

                }
            });
        };
    </script>
</head>
<body>
    <noscript>
        <strong>We're sorry, our website doesn't work properly without JavaScript enabled. Please enable JavaScript in your browser to continue.</strong>
    </noscript>
    <header>
        <div class="row">
            <div class="col"></div>
            <div class="col-6">
                <div class="header-container">
                    <a class="header-logo-link" href="/">
                        <img class="header-logo-img" src="{% static 'images/logo.svg' %}" alt="logo"/>
                        <h1>WHOLE CARS MARKET</h1>
                    </a>
                    <h2 class="header-motto">All cars in one place</h2>
                </div>
            </div>
            <div class="col"></div>
        </div>
    </header>
    <div class="row">
        <div class="col"></div>
        <div class="col-6">
            <div class="row">
                {% include 'search/filters.html' with filters=filters%}
            </div>
            <div class="row" id="ads-container">
                {% include 'search/ads.html' with ad=ads %}
            </div>
        </div>
        <div class="col"></div>
</body>
</html>